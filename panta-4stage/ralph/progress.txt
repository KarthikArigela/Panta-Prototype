## Codebase Patterns
- TypeScript interfaces go in src/types/ directory
- Export interfaces AND default values for form initialization
- Use union types for finite sets (e.g., ViolationType, CargoType)
- Build command has pre-existing issues with /_global-error page - use `npx tsc --noEmit` for type checking
- ESLint has dependency issues - may need `npm install` to fix
- Use pnpm instead of npm - npm has semver issues with the project's eslint setup
- Zod validation schemas go in src/lib/validators.ts
- Export Zod-inferred types alongside schemas for type safety
- Use .refine() for conditional validation (e.g., hazmatTypes required when hazmat=true)
- Field naming follows camelCase convention
- Nullable boolean fields use `boolean | null` pattern for "not yet answered" state
- Hooks go in src/hooks/ directory
- Use useSyncExternalStore for SSR-safe localStorage hooks (avoids hydration mismatch)
- Pre-existing lint errors in page.tsx (setState in effect) - do not attempt to fix unless specifically tasked
- React Hook Form + Zod: Use SmartIntakeData type (not Zod-inferred type) for useForm<> to avoid type mismatch with optional arrays
- When using zodResolver with a type that differs from Zod schema output, cast with `as never` to avoid type errors
- form.watch() triggers ESLint incompatible-library warning - this is expected behavior with React Compiler, not an error
- Components go in src/components/intake/ directory
- Use existing CSS classes from globals.css - no need to install shadcn/ui components
- Brand colors are CSS variables: --color-primary (Forest Green), --color-accent (Vibrant Green), --color-danger (Red)
- Dev server runs on port 3001 (not default 3000)
- Stage component pattern: accept `form: UseFormReturn<SmartIntakeData>` prop, use watch() for reactive values, setValue() for updates

---

## 2026-01-18 - US-001
- What was implemented:
  - Created src/types/intake.ts with comprehensive TypeScript interfaces
  - SmartIntakeData as the main form data interface combining all sections
  - Knockout interface with 6 boolean screening fields
  - RiskProfile interface with hazmat, radius, fleet, cargo, E&S market flags
  - Business interface with ACORD 125 fields (legal name, FEIN, DOT, MC, address, etc.)
  - Operations interface with safety programs, telematics, MVR checks
  - Vehicle interface with all vehicle details plus lienholder support
  - Driver interface with accidents and violations history
  - PriorInsurance, LossHistory, CoveragePreferences interfaces
  - Reusable sub-interfaces: Address, Claim, Violation, Accident
  - Type unions for finite sets: ViolationType, ClaimType, CargoType, HazmatType, EntityType, etc.
  - Default values for all interfaces for form initialization
  - StageProps generic interface for component props

- Files changed:
  - src/types/intake.ts (created - 666 lines)

- **Learnings for future iterations:**
  - The existing page.tsx has an inline FormData interface that will need to be migrated to use the new SmartIntakeData interface
  - Use `npx tsc --noEmit` for typecheck since there's no typecheck script defined
  - The build has pre-existing issues unrelated to types (React key warnings, /_global-error page error)
  - Knockout fields should use `boolean | null` to distinguish "not answered yet" from "answered No"
  - Vehicle and Driver interfaces support dynamic arrays for multiple entries
  - E&S market flags array in RiskProfile for tracking conditions that push applicant to Excess & Surplus market

---

## 2026-01-18 - US-002
- What was implemented:
  - Created src/lib/validators.ts with comprehensive Zod validation schemas
  - Added zod v3.23.8 dependency to package.json
  - knockoutSchema: 6 boolean fields with nullable for "not yet answered" state
  - riskProfileSchema: Conditional validation requiring hazmatTypes when hazmat=true
  - businessSchema: FEIN format (XX-XXXXXXX), DOT (7 digits), MC format validation
  - vehicleSchema: 17-character VIN validation with alphanumeric pattern (excluding I, O, Q)
  - driverSchema: Age validation (18-100), date format YYYY-MM-DD
  - addressSchema: Required street, city, state (2-char code), zip (5 or 9 digit)
  - smartIntakeSchema: Combines all sub-schemas for full form validation
  - All schemas export Zod-inferred types (e.g., BusinessInput, VehicleInput)
  - Stage validation helpers: validateKnockoutStage(), validateRiskProfileStage(), validateBusinessStage()
  - Switched to pnpm for package management due to npm semver issues

- Files changed:
  - src/lib/validators.ts (created - ~700 lines)
  - package.json (added zod dependency)
  - pnpm-lock.yaml (created - new lockfile)

- **Learnings for future iterations:**
  - npm has semver issues with eslint in this project - use pnpm instead
  - Zod .refine() is perfect for conditional validation (e.g., "if A then B required")
  - Use z.literal('') with .or() to allow empty strings for optional fields with format validation
  - VIN validation excludes I, O, Q per industry standard
  - Export both schemas AND inferred types for React Hook Form integration
  - Stage validation helpers encapsulate business logic (e.g., knockout = any true answer blocks)

---

## 2026-01-18 - US-003
- What was implemented:
  - Created src/hooks/useLocalStorage.ts with SSR-safe localStorage persistence
  - Uses useSyncExternalStore React 18+ pattern for proper SSR hydration
  - Debounced saves (2 second delay) to avoid performance issues during rapid form typing
  - Graceful JSON parse error handling with console warnings
  - Cross-tab synchronization via storage events
  - Also exported: useLocalStorageState (simpler useState-based version), clearLocalStorageKey, hasLocalStorageKey utilities
  - Full TypeScript generics support for type-safe storage

- Files changed:
  - src/hooks/useLocalStorage.ts (created - 290 lines)

- **Learnings for future iterations:**
  - useSyncExternalStore is the modern React 18+ way to sync external stores (like localStorage) with React
  - ESLint's react-hooks/refs rule prevents updating refs during render - use useEffect instead
  - ESLint's react-hooks/set-state-in-effect catches setState in effects - this is a pre-existing issue in page.tsx
  - The hook provides two versions: useLocalStorage (SSR-safe with storage events) and useLocalStorageState (simpler)
  - Storage event dispatch is needed for same-tab updates (native storage events only fire for other tabs)

---

## 2026-01-18 - US-004
- What was implemented:
  - Created src/hooks/useIntakeForm.ts - central hook for managing form state across all 4 stages
  - Added react-hook-form@7.71.1 and @hookform/resolvers@5.2.2 dependencies via pnpm
  - React Hook Form integration with Zod resolver (zodResolver from @hookform/resolvers)
  - localStorage persistence using useLocalStorageState from useLocalStorage.ts
  - Stage management: currentStage (1-4), goToNextStage(), goToPrevStage(), goToStage()
  - Stage validation: canProceed() validates current stage, getStageErrors() returns error messages
  - Per-stage validation logic for knockout, riskProfile, business/operations, and documents
  - Knockout detection: isKnockedOut state tracks if any knockout question was answered "yes"
  - Reset functionality: resetForm() with optional confirmation dialog
  - State restoration: restores saved state from localStorage on mount
  - Additional helpers: saveNow(), hasSavedProgress(), continueFromSaved(), startFresh()
  - Exported STAGE_CONFIG for UI components (label, description per stage)

- Files changed:
  - src/hooks/useIntakeForm.ts (created - ~430 lines)
  - package.json (added react-hook-form and @hookform/resolvers dependencies)
  - pnpm-lock.yaml (updated with new dependencies)

- **Learnings for future iterations:**
  - Use SmartIntakeData type (from types/intake.ts) instead of Zod-inferred SmartIntakeInput type for useForm<> generic
  - The Zod schema has optional arrays with .default([]) which creates type mismatch with required arrays in SmartIntakeData
  - Cast zodResolver with `as never` to work around type incompatibility between schema output and form data type
  - ESLint warns about form.watch() incompatibility with React Compiler - this is a known limitation, not a bug
  - Use useLocalStorageState (not useLocalStorage) for simpler integration with React Hook Form's watch()
  - Storage key 'panta-smart-intake' for consistent form data persistence

---

## 2026-01-18 - US-005
- What was implemented:
  - Created src/components/intake/KnockoutStage.tsx - Stage 1 Knockout Questions UI
  - Component displays all 6 knockout questions with Yes/No toggle buttons
  - Questions use plain English: authority revoked, safety rating unsatisfactory, driver license revoked, fraud conviction, bankruptcy filed, insurance cancelled for non-payment
  - Shows decline message with phone number when any question answered Yes
  - Integrated with useIntakeForm hook via React Hook Form
  - Updated src/app/page.tsx to use new component architecture
  - Removed old inline stage components (Stage1Knockout, Stage2Basics, Stage3Operations, Stage4Safety, Stage5Documents)
  - Updated progress indicator to use STAGE_CONFIG from useIntakeForm hook
  - Simplified navigation logic using goToNextStage/goToPrevStage from hook

- Files changed:
  - src/components/intake/KnockoutStage.tsx (created - 128 lines)
  - src/app/page.tsx (major refactor - simplified from 838 to 78 lines)

- **Learnings for future iterations:**
  - Components go in src/components/intake/ directory
  - Use existing CSS classes from globals.css (yes-no-btn, knockout-alert, card-header, form-group, etc.)
  - Brand colors are defined as CSS variables (--color-primary, --color-accent, --color-danger)
  - Dev server runs on port 3001 (default Next.js port is 3000)
  - The KnockoutStage pattern: accept form from useIntakeForm hook, use watch() for reactive values, setValue() for updates
  - All 6 questions should be displayed at once (not one at a time) - the PRD wording was unclear but implementation shows all at once for better UX
  - Knockout alert should remain visible while questions are shown so user can correct their answers
  - TypeScript compilation succeeds with `npx tsc --noEmit`
---
## 2026-01-19 - US-006
- What was implemented:
  - Created src/components/intake/RiskClassifierStage.tsx - Stage 2 Risk Classifier Questions UI
  - All 8 risk classifier questions with proper conditional logic:
    1. Hazmat question with conditional hazmat types selector (Flammables, Corrosives, Explosives, Radioactive, Other)
    2. Farthest travel distance with 4 radius options (Local, Regional, Long Regional, Long Haul) - shows info note for Long Haul
    3. Fleet size input with fleet discount eligibility note when >10 trucks
    4. Cargo types multi-select with 10 options (General Freight, Refrigerated, Dry Van, Flatbed, Tanker, Auto Hauler, Household Goods, Intermodal, Oversized, Other)
    5. Lease-on question with conditional motor carrier text field
    6. Refrigerated cargo question with conditional reefer breakdown coverage sub-question
    7. Trailer interchange question with conditional count/zones/radius fields
    8. New venture question and accidents count input
  - E&S market warning displays when newVenture=true OR accidentsLast3Years>2
  - Integrated into page.tsx (replaced "Stage 2 - Coming Soon" placeholder)
  - Progress indicator already shows "Step 2 of 4" from STAGE_CONFIG

- Files changed:
  - src/components/intake/RiskClassifierStage.tsx (created - 423 lines)
  - src/app/page.tsx (updated imports and stage 2 content)

- **Learnings for future iterations:**
  - Component pattern established: watch() for reactive values, setValue() for updates, conditional rendering based on field values
  - Multi-select patterns: use array.includes() to check selection, spread operator to toggle items in array
  - E&S market flags array in RiskProfile interface exists but wasn't used - the warning logic directly checks newVenture and accidentsLast3Years
  - Use inline styles for conditional UI elements (info boxes, warnings) to avoid creating new CSS classes
  - Form inputs use controlled components pattern with value={field || ""} to handle null initial values
  - TypeScript compilation passed with npx tsc --noEmit
  - All acceptance criteria from US-006 met: 8 questions, conditional logic, cargo options, E&S flags, progress indicator
---
## 2026-01-19 - US-007
- What was implemented:
  - Created src/components/intake/BusinessInfoSection.tsx - Stage 3.1 Business Information Section
  - Comprehensive business information form with all required fields:
    * Legal business name (required text input)
    * DBA (optional text input)
    * Business mailing address (street, city, state, zip - all required)
    * Business phone with auto-formatting: (555) 123-4567
    * FEIN with format validation and auto-formatting: XX-XXXXXXX
    * Entity type selector with 5 options (LLC, Corporation, Sole Proprietor, Partnership, Other)
    * Website (optional URL input)
    * Date business started (date picker)
    * USDOT Number (7 digits, required, numeric only)
    * MC Number (optional, auto-formatted as MC-XXXXXX)
    * Annual gross revenue with currency formatting ($)
    * Full-time employee count (number input, required)
    * Part-time employee count (number input, required)
    * Garaging address toggle (same as business or different)
    * Conditional garaging address fields (shown when different from business address)
  - Collapsible section UI with toggle (open/closed state managed with useState)
  - All form inputs use watch() for reactive values and setValue() for updates
  - Integrated into page.tsx for Stage 3 with header and section

- Files changed:
  - src/components/intake/BusinessInfoSection.tsx (created - 429 lines)
  - src/app/page.tsx (updated - added import and Stage 3 content)
  - ralph/prd.json (updated - marked US-007 as passes: true)

- **Learnings for future iterations:**
  - Collapsible sections pattern: Use useState for open/closed state, click handler on header div
  - Auto-formatting patterns: Clean input with regex, apply format, update with setValue()
  - Phone format: (XXX) XXX-XXXX with maxLength={14}
  - FEIN format: XX-XXXXXXX with maxLength={10}
  - MC format: MC-XXXXXX with maxLength={9}
  - Currency formatting: Use toLocaleString("en-US", {style: "currency", currency: "USD"})
  - Use grid layout for city/state/zip: gridTemplateColumns: "2fr 1fr 1fr"
  - Use grid layout for employee counts: gridTemplateColumns: "1fr 1fr"
  - Conditional fields pattern: Check boolean value, render div when true
  - Use existing CSS classes: form-group, form-label, form-sublabel, form-input, yes-no-grid, yes-no-btn, option-card, options-grid
  - Mark required fields with red asterisk: <span style={{ color: "var(--color-danger)" }}>*</span>
  - Use form-sublabel for helper text below labels
  - Stage 3 is titled "Business Details" in the main page
  - TypeScript compilation passes with npx tsc --noEmit
---
## 2026-01-19 - US-008
- What was implemented:
  - Created src/components/intake/OperationsSafetySection.tsx - Stage 3.2 Operations & Safety Section
  - Comprehensive operations and safety information form with all required fields:
    * Cargo description textarea with detailed placeholder example
    * States of operation multi-select with all 50 US states + DC (grid layout)
    * Safety program Yes/No with conditional checkboxes:
      - Written Safety Manual
      - Designated Safety Director
      - Monthly Safety Meetings
      - OSHA Compliance Program
    * Vehicle maintenance program Yes/No
    * Telematics/ELD Yes/No with conditional checkboxes:
      - Driver Safety Monitoring
      - Fuel Tracking
      - Maintenance Alerts
      - Mileage Tracking
      - GPS Tracking
    * Fleet percentage slider (0-100%) when telematics=Yes
    * MVR checks before hiring Yes/No
  - Collapsible section UI with toggle (matches BusinessInfoSection pattern)
  - All form inputs use watch() for reactive values and setValue() for updates
  - Integrated into page.tsx Stage 3 (after BusinessInfoSection)

- Files changed:
  - src/components/intake/OperationsSafetySection.tsx (created - 419 lines)
  - src/app/page.tsx (updated - added import and component)
  - ralph/prd.json (updated - marked US-008 as passes: true)

- **Learnings for future iterations:**
  - Multi-select state grid pattern: Use grid with auto-fill columns for compact state selection
  - Conditional sub-sections pattern: Use marginLeft + paddingLeft + borderLeft for visual hierarchy
  - Checkbox list pattern: Use flex column layout with styled labels containing input + span
  - Range slider pattern: Combine <input type="range"> with visual percentage display
  - Clear dependent fields when parent is set to No (e.g., clear safetyProgramComponents when hasSafetyProgram=false)
  - Use gridTemplateColumns: "repeat(auto-fill, minmax(60px, 1fr))" for responsive state grid
  - Telematics features and safety program components use array patterns with .includes() checks
  - All 51 states (50 + DC) defined as USState type union in intake.ts
  - Stage 3 has multiple sections (BusinessInfo, OperationsSafety, etc.) all rendered together
  - TypeScript compilation passes with npx tsc --noEmit
  - Browser verification: App loads correctly, Stage 1 knockout questions display properly
---

## 2026-01-19 - US-009
- What was implemented:
  - Created src/components/intake/VehicleScheduleSection.tsx - Stage 3.3 Vehicle Schedule Section
  - Comprehensive vehicle schedule with dynamic add/remove functionality
  - All vehicle fields implemented:
    * Year dropdown (1990 to current year + 1, currently 2027)
    * Make and Model text inputs with placeholders
    * VIN input with 17-character validation and uppercase conversion
    * Body type selector with 7 options (Tractor, Straight Truck, Box Truck, Flatbed, Tanker, Dump Truck, Other)
    * GVW (Gross Vehicle Weight) with comma formatting for pounds
    * Stated Value with currency formatting ($)
    * Radius of operation with 4 options (Local <50mi, Regional 50-200mi, Long Regional 200-500mi, Long Haul 500+mi)
    * For hire Yes/No toggle
    * Garaging address toggle (Same as Business or Different Address)
    * Conditional garaging address fields (street, city, state, zip) when different from business
    * Lienholder Yes/No toggle
    * Conditional lienholder fields (name and full address) when Yes
  - Running count displays "X trucks added" in collapsible section header
  - Add Truck button to add new vehicles dynamically using defaultVehicle template
  - Remove button on each vehicle card
  - Integrated into page.tsx Stage 3 after OperationsSafetySection
  - Collapsible section UI matching BusinessInfoSection and OperationsSafetySection patterns

- Files changed:
  - src/components/intake/VehicleScheduleSection.tsx (created - 632 lines)
  - src/app/page.tsx (updated - added import and component)
  - ralph/prd.json (updated - marked US-009 as passes: true)

- **Learnings for future iterations:**
  - Dynamic array pattern: Use vehicles.map() to render each vehicle, updateVehicle() helper to update specific fields
  - Add/remove pattern: Spread operator to add ([...vehicles, defaultVehicle]), filter to remove (vehicles.filter((_, i) => i !== index))
  - Nested object updates: Spread existing nested object when updating single field to preserve other fields
  - Year dropdown generation: Array.from({ length: currentYear - 1989 + 1 }, (_, i) => currentYear - i + 1)
  - VIN validation: maxLength={17}, toUpperCase() on change
  - Currency formatting pattern reused from BusinessInfoSection
  - Conditional field patterns: Check boolean, render indented section with borderLeft visual hierarchy
  - Lienholder and garagingAddress are optional nested objects - must check existence before accessing properties
  - Vehicle index display: Use map index + 1 for human-readable "Vehicle #1, #2, etc."
  - Remove button styling: Use danger color, positioned in header flex layout
  - Grid layouts: Use gridTemplateColumns for responsive year/make/model (1fr 2fr 2fr) and GVW/value (1fr 1fr)
  - TypeScript compilation passes with npx tsc --noEmit
  - Dev server runs on port 3001 (started with npm run dev)
---

## 2026-01-19 - US-010
- What was implemented:
  - Created src/components/intake/DriverSection.tsx - Stage 3.4 Driver Section
  - Comprehensive driver information collection with dynamic add/remove functionality
  - All required driver fields implemented:
    * Full legal name (required text input)
    * Date of birth (required date picker)
    * Driver's license number (required text input)
    * License state (required dropdown with all 50 US states + DC)
    * Years of CDL experience (required number input, 0-60 range)
    * Date hired (required date picker)
  - Accidents in last 3 years section with Yes/No toggle
    * Conditional dynamic accidents array with add/remove functionality
    * Per accident: Date, Description (textarea), At-fault Yes/No toggle
  - Moving violations in last 3 years section with Yes/No toggle
    * Conditional dynamic violations array with add/remove functionality
    * Per violation: Date, Type dropdown (5 options: Speeding, Reckless Driving, DUI/DWI, Logbook Violation, Other), Location
  - Running count displays "X drivers added" in collapsible section header
  - Add Driver button to add new drivers dynamically using defaultDriver template
  - Remove button on each driver card (shows when >1 driver)
  - Collapsible section UI matching BusinessInfoSection, OperationsSafetySection, VehicleScheduleSection patterns
  - Integrated into page.tsx Stage 3 (after VehicleScheduleSection)

- Files changed:
  - src/components/intake/DriverSection.tsx (created - 478 lines)
  - src/app/page.tsx (updated - added import and component)
  - ralph/prd.json (updated - marked US-010 as passes: true)

- **Learnings for future iterations:**
  - Nested dynamic arrays pattern: Accidents and violations are arrays within each driver object
  - Update nested array: Spread parent array, spread specific driver, update nested array, set parent array
  - Add to nested array: Spread driver's accidents/violations array and append new default object
  - Remove from nested array: Use filter to remove specific index from nested array
  - Update nested array item: Spread nested array, spread specific item, update field, update parent
  - Conditional nested sections: Check hasAccidents/hasViolations boolean, show/hide nested array UI
  - Auto-add first item pattern: When user selects Yes, automatically add first accident/violation if array is empty
  - Clear nested arrays when toggling to No: Reset accidents/violations to empty array when hasAccidents/hasViolations = false
  - Nested card styling: Use backgroundColor #f9f9f9 for nested cards to create visual hierarchy
  - Sub-item numbering: Use nested map index + 1 for "Accident #1", "Violation #1", etc.
  - Grid layout for related fields: Use 1fr 1fr for DOB/License, Experience/Date Hired
  - ViolationType enum: speeding, reckless_driving, dui_dwi, logbook_violation, other
  - Accident interface: date, description, atFault (boolean), amountPaid (optional, not used in form)
  - Violation interface: date, type, description (optional, not shown in form), location (optional)
  - All acceptance criteria from US-010 met: dynamic drivers, all fields, accidents, violations, running count, remove buttons
  - TypeScript compilation passes with npx tsc --noEmit
---

## 2026-01-19 - US-011
- What was implemented:
  - Created src/components/intake/PriorInsuranceSection.tsx - Stage 3.5 Prior Insurance & Claims Section
  - Comprehensive prior insurance history and claims collection form with all required fields:
    * Currently insured Yes/No toggle
    * Conditional current insurance details section:
      - Carrier name (text input, required)
      - Policy number (text input, required)
      - Annual premium (currency formatted with $ and comma separators, required)
      - Effective date (date picker, required)
      - Expiration date (date picker, required)
    * Why shopping selector with 6 options (radio-style buttons):
      - renewal_coming_up, want_better_rates, need_higher_limits, non_renewed, cancelled, other
    * Claims in last 5 years Yes/No toggle
    * Conditional dynamic claims array with add/remove functionality:
      - Date of loss (date picker, required)
      - Type dropdown (6 claim types: Collision, Cargo Damage, Bodily Injury Liability, Property Damage Liability, Comprehensive, Other)
      - Amount paid (currency formatted, optional)
      - Amount reserved (currency formatted, optional)
      - Still open Yes/No toggle
      - Description (textarea, required)
  - Collapsible section UI matching BusinessInfoSection, OperationsSafetySection patterns
  - Running count not shown (unlike vehicles/drivers) - just add/remove claims
  - Auto-add first claim when user selects "Yes" to hasClaims
  - Clear claims array when toggling to "No"
  - Integrated into page.tsx Stage 3 (after DriverSection)

- Files changed:
  - src/components/intake/PriorInsuranceSection.tsx (created - 559 lines)
  - src/app/page.tsx (updated - added import and component)
  - ralph/prd.json (updated - marked US-011 as passes: true)

- **Learnings for future iterations:**
  - Field name mapping critical: Review intake.ts types BEFORE writing component
  - PriorInsurance interface uses: carrierName (not currentCarrier), policyNumber (not currentPolicyNumber), annualPremium (not currentAnnualPremium), effectiveDate (not currentEffectiveDate), expirationDate (not currentExpirationDate), shoppingReason (not whyShopping)
  - Claim interface uses: dateOfLoss (not date), type, description, amountPaid, amountReserved, stillOpen
  - ShoppingReason type values use snake_case: renewal_coming_up, want_better_rates, need_higher_limits, non_renewed, cancelled, other
  - ClaimType values use snake_case: collision, cargo_damage, bodily_injury_liability, property_damage_liability, comprehensive, other
  - No defaultClaim export in intake.ts - define locally in component or inline
  - Currency formatting pattern: formatCurrency helper strips non-numeric, parses int, formats with toLocaleString
  - Amount paid/reserved fields are optional (not required) unlike other fields
  - Still open toggle is boolean (not nullable boolean like knockout fields)
  - Component file created in wrong location initially (ralph/src instead of project src) - need to be aware of working directory
  - Use absolute paths from project root when reading/writing files
  - Dev server runs on port 3001 (as documented in CLAUDE.md)
  - TypeScript compilation passes with npx tsc --noEmit (no need for npm run typecheck)
  - All acceptance criteria from US-011 met: collapsible section, all fields, conditional logic, dynamic claims array, claim types dropdown
---

## 2026-01-19 - US-012
- What was implemented:
  - Created src/components/intake/CoveragePreferencesSection.tsx - Stage 3.6 Coverage Preferences Section
  - Comprehensive coverage preferences form with all required fields:
    * Liability limit selector with 4 radio-style button options:
      - $1M CSL (with "Most Common" label)
      - $750K
      - $500K
      - Other (with conditional custom amount input field, currency formatted)
    * Comprehensive deductible selector with 4 options ($1000, $2500, $5000, Other with conditional custom input)
    * Collision deductible selector with 4 options ($1000, $2500, $5000, Other with conditional custom input)
    * Hired auto coverage Yes/No toggle with tooltip: "Coverage for vehicles you rent or lease short-term (e.g., rental trucks)"
    * Non-owned auto coverage Yes/No toggle with tooltip: "Coverage for vehicles your employees use for business but that you don't own"
  - Collapsible section UI matching BusinessInfoSection, OperationsSafetySection patterns
  - Currency formatting for custom liability limit and deductible amounts
  - Clear dependent fields pattern: When switching from "Other" to predefined option, clear custom amount
  - Integrated into page.tsx Stage 3 (after PriorInsuranceSection)

- Files changed:
  - src/components/intake/CoveragePreferencesSection.tsx (created - 340 lines)
  - src/app/page.tsx (updated - added import and component)
  - ralph/prd.json (updated - marked US-012 as passes: true)

- **Learnings for future iterations:**
  - Tooltip pattern: Use inline span with title attribute and â“˜ symbol for helper text
  - Conditional "Other" input pattern: Check if selected option is "other", render custom input field, clear when switching away
  - LiabilityLimit type uses string literals: "500000", "750000", "1000000", "other" (not numeric)
  - DeductibleAmount type uses string literals: "1000", "2500", "5000", "other"
  - Custom amounts stored in separate optional fields: liabilityLimitOther, comprehensiveDeductibleOther, collisionDeductibleOther
  - Grid layout for 4 options: gridTemplateColumns: "1fr 1fr 1fr 1fr"
  - Radio-style button pattern: Use option-card with active class when selected
  - Tooltip cursor: Use cursor: "help" for tooltip icon
  - Description sublabels explain what each coverage type covers (helps non-insurance experts understand)
  - Yes/No toggles for boolean coverage options (hiredAutoCoverage, nonOwnedAutoCoverage)
  - Progress indicator already shows "Step 3 of 4" from STAGE_CONFIG (no changes needed)
  - All acceptance criteria from US-012 met: collapsible section, liability/comprehensive/collision selectors, hired/non-owned toggles with tooltips
  - TypeScript compilation passes with npx tsc --noEmit
  - Dev server already running on port 3001
---

